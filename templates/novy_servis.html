<!-- templates/novy_servis.html -->

{% extends "base.html" %}
{% block title %}Nový servis{% endblock %}

{% block content %}
<div class="card">
    <div class="page-title">Nový servis</div>
    <div class="page-subtitle">Vyber zákazníka a jeho bicykel, potom založ servisnú objednávku.</div>

    <form method="get" style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:16px;">
        <select name="customer" style="padding:10px 12px; border-radius:10px; border:1px solid #d1d5db; min-width:280px;" onchange="this.form.submit()">
            <option value="">Vyber zákazníka</option>
            {% for c in customers %}
                <option value="{{ c.id }}" {% if selected_customer_id == c.id %}selected{% endif %}>
                    {{ c.full_name }} ({{ c.email }})
                </option>
            {% endfor %}
        </select>

        <select name="bike" style="padding:10px 12px; border-radius:10px; border:1px solid #d1d5db; min-width:280px;" onchange="this.form.submit()">
            <option value="">Vyber bicykel</option>
            {% for b in bikes %}
                <option value="{{ b.id }}" {% if selected_bike_id == b.id %}selected{% endif %}>
                    {{ b.brand }} {{ b.model }} / S/N {{ b.serial_number }}
                </option>
            {% endfor %}
        </select>
    </form>

    <form method="post" style="display:grid; grid-template-columns:1fr 1fr; gap:14px;">
        {% csrf_token %}

        <input type="hidden" name="customer_id" value="{{ selected_customer_id }}">
        <input type="hidden" name="bike_id" value="{{ selected_bike_id }}">

        <div style="grid-column:1 / -1; padding:12px 14px; background:#f9fafb; border:1px solid #e5e7eb; border-radius:12px; color:#6b7280;">
            {% if not selected_customer_id %}
                Najprv vyber zákazníka.
            {% elif not selected_bike_id %}
                Vyber bicykel zákazníka.
            {% else %}
                Môžeš založiť servisnú objednávku.
            {% endif %}
        </div>

        <div>
            <label style="display:block; font-weight:700; margin-bottom:6px;">Nahlásená vada</label>
            <textarea name="issue_description" rows="6" style="width:100%; padding:10px 12px; border-radius:10px; border:1px solid #d1d5db;"></textarea>
        </div>

        <div>
            <label style="display:block; font-weight:700; margin-bottom:6px;">Čo sa urobilo</label>
            <textarea name="work_done" rows="6" style="width:100%; padding:10px 12px; border-radius:10px; border:1px solid #d1d5db;"></textarea>
        </div>

        <div style="grid-column:1 / -1; display:flex; gap:10px; align-items:center;">
            <div style="flex:0 0 220px;">
                <label style="display:block; font-weight:700; margin-bottom:6px;">Cena</label>
                <input type="number" step="0.01" name="price" value="0" style="width:100%; padding:10px 12px; border-radius:10px; border:1px solid #d1d5db;">
            </div>

            <button type="submit" {% if not selected_bike_id %}disabled{% endif %} style="margin-top:24px; padding:12px 16px; border-radius:12px; border:0; background:#111827; color:#fff; font-weight:800; cursor:pointer; opacity:{% if not selected_bike_id %}0.5{% else %}1{% endif %};">
                Vytvoriť servis
            </button>
        </div>
    </form>
</div>
{% endblock %}