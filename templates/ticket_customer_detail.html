<!-- templates/ticket_customer_detail.html -->
{% extends "base.html" %}

{% block content %}
<div class="page-head">
  <div>
    <div class="title">Ticket #{{ ticket.id }}</div>
    <p class="subtitle">
      Servis #{{ ticket.order.service_code|default:ticket.order_id }} · {{ ticket.order.bike.brand }} {{ ticket.order.bike.model }}
    </p>
    <div style="margin-top:10px;">
      <span class="chip chip-gray">Stav: {{ ticket.get_status_display }}</span>
    </div>
  </div>
  <a class="btn btn-light" href="{% url 'customer_ticket_list' %}">Späť</a>
</div>

{% if is_closed %}
  <div class="card" style="margin-top:14px; border-color:#f59e0b; background:#fef3c7; box-shadow:none;">
    <div class="card-pad" style="padding:12px;">
      <div style="font-weight:900;">Ticket je zatvorený.</div>
      <div style="margin-top:4px; color:#92400e;">Ak potrebuješ riešiť niečo nové, vytvor nový ticket k servisu.</div>
    </div>
  </div>
{% endif %}

<div class="card" style="margin-top:14px;">
  <div class="card-pad" style="border-bottom:1px solid var(--line); font-weight:900;">
    Predmet: {{ ticket.subject|default:"Ticket" }}
  </div>

  <div class="card-pad">
    {% for m in ticket.messages.all %}
      {% if m.role == "customer" %}
        <div class="bubble-row bubble-right bubble-customer">
          <div class="bubble">
            <div class="bubble-head">
              <div style="font-weight:900; color:var(--orangeText);">Ty</div>
              <div class="small">{{ m.created_at|date:"d.m.Y H:i" }}</div>
            </div>
            <div class="bubble-body">{{ m.message }}</div>
          </div>
        </div>
      {% elif m.role == "admin" %}
        <div class="bubble-row bubble-left bubble-admin">
          <div class="bubble">
            <div class="bubble-head">
              <div style="font-weight:900; color:var(--blueText);">Servis</div>
              <div class="small">{{ m.created_at|date:"d.m.Y H:i" }}</div>
            </div>
            <div class="bubble-body">{{ m.message }}</div>
          </div>
        </div>
      {% else %}
        <div class="bubble-row bubble-left">
          <div class="bubble">
            <div class="bubble-head">
              <div style="font-weight:900; color:#374151;">Systém</div>
              <div class="small">{{ m.created_at|date:"d.m.Y H:i" }}</div>
            </div>
            <div class="bubble-body">{{ m.message }}</div>
          </div>
        </div>
      {% endif %}
    {% empty %}
      <div class="muted">Zatiaľ bez správ.</div>
    {% endfor %}
  </div>
</div>

{% if not is_closed %}
  <div class="card" style="margin-top:14px;">
    <div class="card-pad">
      <form method="post" style="display:flex; flex-direction:column; gap:12px;">
        {% csrf_token %}
        <div>
          <label class="label">Tvoja správa</label>
          <textarea class="input" name="message" rows="6" style="resize:vertical;" placeholder="Napíš otázku alebo doplnenie"></textarea>
        </div>
        <div style="display:flex; justify-content:flex-end;">
          <button class="btn btn-dark" type="submit">Odoslať</button>
        </div>
      </form>
    </div>
  </div>
{% endif %}
{% endblock %}